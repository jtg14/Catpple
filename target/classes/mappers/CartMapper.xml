<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "portfolio.mapper.CartMapper">

	<insert id="infoToCart" >
	insert into Cart (CID,CAMOUNT,MEMBER_MID,GOODS_GNUM) values((select ifnull(max(cId),0)+1 from cart as cId),#{cAmount},#{member_mId},#{goods_gNum})
	</insert>
	<select id="findDupGoods" resultType="vo.CartVO">
	select * from Cart where member_mid = #{member_mId} and goods_gnum = ${goods_gNum}
	</select>
	<select id="cartList" resultType="vo.CartVO">
	 	select c.cId,c.camount,c.member_mid,c.goods_gnum,g.gname,g.gprice,g.member_mid sellerID,
	 	g.gimg1 from Cart c,Goods g where c.goods_gnum = g.gnum and c.member_mid=#{mId}
	</select>
	<delete id="deleteCart">
		delete from cart where cid = #{cId}
	</delete>
	<select id="getCartRow" resultType="integer">
		select count(*) from cart where member_mid = #{mId};
	</select>
	<select id="purchaseList" resultType="vo.CartVO" parameterType="java.util.HashMap">
    select c.*,g.gnum,g.gname,g.gprice from cart c ,goods g where c.goods_gnum = g.gnum and c.member_mid ='${member_mId}' and
                <foreach collection="cIdList" item="item" index="index" separator="or" open="(" close=")">
                cId = ${item}       
           </foreach>
          
	</select>

	<select id="selectReceivedOrderList" resultType="vo.CartVO">
		select g.gimg1, g.gstock, g.gname, g.gprice, o.member_mid, o.ostock, d.dstate, d.ddate from goods as g, corder as o, delivery as d 
		where g.gnum=o.goods_gnum and o.onum=d.corder_onum and g.member_mId=#{member_mId} order by d.dstate, d.ddate;
	
	</select>
	


</mapper>